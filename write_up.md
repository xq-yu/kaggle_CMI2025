## TEAM solution is [here](https://www.kaggle.com/competitions/cmi-detect-behavior-with-sensor-data/writeups/3rd-place-solution)
## Some details of my pipeline

### 1. Data process
### 1.1 Quat Smoothing
In the raw data, rot_w was forced to be positive. When rot_w was supposed to change from positive to negative, rot_x, rot_y, and rot_z would suddenly reverse, causing a discontinuity over time. I smoothed the quaternion data by flipping the quaternion values starting from time T onwards whenever such a discontinuity was detected at time T.

The quaternion data could become more inconsistent because the entire quaternion sequence for some trials might be reversed, even though its real meaning remains the same. To keep the model stable, I used a symmetric processing method: rot_block(quat) + rot_block(-quat).

### 1.2 Handling Left-Handed Subjects
- [Acc] Flip acc_x
- [Quat] Since we do not know exactly which direction the subjects are facing, we should make the direction of left/right-handed subjects symmetric along the z-y plane (rotate left-handed subjects -110 degrees around the z-axis of the world coordinate system). We then flip rot_w and rot_x. Finally, keep rot_w positive as in the raw data (if quaternion smoothing is not applied).
- [thm] Switch thm_3 and thm_5.
- [tof] Left-right flip for tof[1, 2, 4] and upside-down flip for tof[3, 5], then switch tof_3 and tof_5.

### 1.3 Incorrectly Worn Devices
- The users ['SUBJ_019262', 'SUBJ_045235'] did not wear the device correctly, resulting in reversed y_acc and x_acc readings and a 180-degree rotation of the ToF data.
- I created an outlier sequence classifier model. Negative samples were generated by rotating the original samples 180 degrees around the z-axis of local coordinate. The model achieved excellent performance (~0.99 AUC). Assuming all sequences would be flipped if a subject wore the device incorrectly, I performed a data probe. The results showed no outlier subjects in both the public and private leaderboards.
- With above conclution, We fixed the data of these two users during train and do nothing during submission.But @Greynow report that "there is at least one subject for which some sequences are flipped in x and y, but this affects less than the majority of its sequences!". What a pity!

### 2. Feature Engineering
- Relative quaternion to the next step based on the local coordinate system.
- Anguler jerk/snap 
- Acc jerk/snap 
- Linear acc
...

### 3. Data Augmentation
- Rotate the quaternion around the z-axis of the world coordinate system by several angles (from -60 to 60 degrees) to increase robustness against the different directions the trial subjects face.
- Rotate both the accelerometer and quaternion data around the y-axis of the local coordinate system by small angles (from -7 to 7 degrees) to increase robustness against slight variations in how the device is worn.
- strech
- shift
- drop
...


### 4.Model
The architecture is illustrated below, key idea is to use multiple branches to deal with different input channels.
![pic](https://i.ibb.co/4Zd0zFgb/model.png)

### 5.Results
- IMU only models - CV: 0.8283
- IMU+THM+ToF model - CV: 0.8850
- Public LB: 0.859, Private LB: 0.848